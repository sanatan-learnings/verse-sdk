# verse-generate

Complete orchestration for verse content generation including text fetching, multimedia generation, and embeddings.

## Synopsis

```bash
verse-generate --collection COLLECTION --verse N [OPTIONS]
```

## Description

The `verse-generate` command is a complete orchestrator for verse content generation. **By default**, it executes the multimedia workflow:
- Reads canonical Devanagari text from local sources
- Generates images using DALL-E 3
- Generates audio pronunciations using ElevenLabs
- Updates vector embeddings for semantic search

Additionally, you can regenerate AI content (transliteration, meaning, translation, story) from the canonical source using `--regenerate-content`.

You can opt-out of specific steps using `--no-fetch-text` or `--no-update-embeddings` flags.

## Options

### Required

- `--collection NAME` - Collection key (e.g., `hanuman-chalisa`, `sundar-kaand`)
- `--verse N` - Verse number or identifier

### Optional

- `--all` - Generate both image and audio (this is the default behavior if no flags specified)
- `--image` - Generate image only
- `--audio` - Generate audio only
- `--regenerate-content` - Regenerate AI content (transliteration, meaning, translation, story) from canonical Devanagari text in `data/verses/{collection}.yaml`
- `--no-update-embeddings` - Skip updating embeddings (embeddings update is enabled by default)
- `--theme NAME` - Image theme name (default: modern-minimalist)
- `--verse-id ID` - Override verse identifier (e.g., chaupai_05, doha_01). Auto-detected if not specified
- `--list-collections` - List all available collections

## Examples

### List Available Collections

```bash
verse-generate --list-collections
```

### Complete Workflow (Default)

The simplest form runs the complete workflow:

```bash
verse-generate --collection hanuman-chalisa --verse 15
```

This automatically:
1. Generates DALL-E 3 image (modern-minimalist theme)
2. Generates full-speed audio pronunciation
3. Generates slow-speed audio pronunciation (0.75x)
4. Updates vector embeddings for semantic search

### Skip Embeddings Update

Faster generation, but search won't include this verse:

```bash
verse-generate --collection hanuman-chalisa --verse 15 --no-update-embeddings
```

### Custom Theme

Use a different theme:

```bash
verse-generate --collection hanuman-chalisa --verse 15 --theme kids-friendly
```

### Generate Specific Components

```bash
# Only image
verse-generate --collection sundar-kaand --verse 3 --image --theme modern-minimalist

# Only audio
verse-generate --collection sankat-mochan-hanumanashtak --verse 5 --audio

# Image and audio with specific theme
verse-generate --collection hanuman-chalisa --verse 20 --all --theme kids-friendly
```

### Regenerate AI Content

When you update the canonical Devanagari text in `data/verses/{collection}.yaml` and want to regenerate all AI-generated content:

```bash
# Regenerate only AI content (transliteration, meaning, translation, story)
verse-generate --collection sundar-kaand --verse 3 --regenerate-content

# Regenerate AI content AND multimedia
verse-generate --collection sundar-kaand --verse 3 --regenerate-content --all

# Regenerate content without updating embeddings (faster)
verse-generate --collection sundar-kaand --verse 3 --regenerate-content --no-update-embeddings
```

This reads the canonical Devanagari text from `data/verses/{collection}.yaml` and uses GPT-4 to generate:
- Transliteration (IAST format)
- Word-by-word meaning
- English translation
- Story & context (2-3 paragraphs)
- Practical applications (2-3 ways to apply teachings)

### Different Collections

```bash
# Hanuman Chalisa
verse-generate --collection hanuman-chalisa --verse 12

# Sundar Kaand (verse ID auto-detected)
verse-generate --collection sundar-kaand --verse 3

# Sankat Mochan Hanumanashtak
verse-generate --collection sankat-mochan-hanumanashtak --verse 7
```

## Generated Files

When using `--all`, the command creates:

1. **Image**: `images/<collection-key>/<theme-name>/verse-NN.png`
   - Generated by DALL-E 3
   - Portrait format (1024x1792)
   - Styled according to theme configuration

2. **Audio files**: `audio/<collection-key>/verse_NN_*.mp3`
   - `verse_NN_full.mp3` - Full speed
   - `verse_NN_slow.mp3` - Slow speed (0.75x)

## Workflow

```bash
# 1. List available collections
verse-generate --list-collections

# 2. Generate everything for a verse (uses default modern-minimalist theme)
verse-generate --collection hanuman-chalisa --verse 15

# 3. Review generated files
open images/hanuman-chalisa/modern-minimalist/verse-15.png
afplay audio/hanuman-chalisa/verse_15_full.mp3

# 4. Commit
git add images/ audio/
git commit -m "Add media for Hanuman Chalisa verse 15"
```

### Fetch Text Only

Preview verse text before generating multimedia:

```bash
verse-generate --collection sundar-kaand --verse 5 --fetch-text
```

This only fetches and displays the traditional Devanagari text without generating any media.

### Regenerate Specific Components

```bash
# Regenerate just the image (with default theme)
verse-generate --collection hanuman-chalisa --verse 15 --image

# Regenerate just the image with custom theme
verse-generate --collection hanuman-chalisa --verse 15 --image --theme kids-friendly

# Regenerate just the audio
verse-generate --collection hanuman-chalisa --verse 15 --audio
```

## Requirements

- **For --fetch-text**: Internet connection + supported collection (no API key needed)
- **For --image**: `OPENAI_API_KEY` + scene description in `docs/image-prompts/<collection-key>.md` + theme config in `docs/themes/<collection-key>/<theme-name>.yml`
- **For --audio**: `ELEVENLABS_API_KEY` + verse file with `devanagari:` field
- **For --update-embeddings**: `OPENAI_API_KEY` for generating vector embeddings
- Collection must be enabled in `_data/collections.yml`

## Notes

- **Default behavior**: Complete workflow - fetches text, generates image + audio with `modern-minimalist` theme, updates embeddings
- Use `--no-fetch-text` to skip text fetching (when verse text already exists)
- Use `--no-update-embeddings` to skip embeddings update (faster, but search won't include this verse)
- Use `--image` or `--audio` to generate only specific components
- Use `--theme` to change from the default `modern-minimalist` theme
- Verse ID is automatically detected from existing verse files (e.g., if `chaupai_05.md` exists, uses `chaupai_05`)
- Use `--verse-id` to override auto-detection when multiple files match (e.g., both `chaupai_05.md` and `doha_05.md` exist)
- For new verses without files, defaults to `verse_{N:02d}` format
- Scene descriptions must exist in `docs/image-prompts/<collection-key>.md` for image generation
- Theme configuration must exist in `docs/themes/<collection-key>/<theme-name>.yml` for image generation
- Audio generation reads from the `devanagari:` field in verse files
- Only enabled collections (in `collections.yml`) can be processed
- Embeddings update processes all collections, not just the current one

## See Also

- [verse-translate](verse-translate.md) - Translate verses into multiple languages
- [verse-status](verse-status.md) - Check status and validate text
- [verse-sync](verse-sync.md) - Sync verse text with canonical source
- [verse-images](verse-images.md) - Image generation details
- [verse-audio](verse-audio.md) - Audio generation details
- [verse-embeddings](verse-embeddings.md) - Vector embeddings for semantic search
- [Troubleshooting](../troubleshooting.md) - Common issues
